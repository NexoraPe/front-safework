<div class="incidents-page">
  <div class="topbar">
    <div class="right-icons">
      <button class="icon-btn">
        <i class="fa fa-bell"></i>
      </button>
    </div>
  </div>

  <h1 class="page-title">List of Incidents</h1>

  <div class="actions-row">
    <button class="new-btn" (click)="openNewIncident()">+ NEW INCIDENT</button>
    <div class="tabs">
      <button
        [class.active]="selectedTab === 'all'"
        (click)="selectTab('all')"
      >
        ALL INCIDENTS
      </button>
      <button
        [class.active]="selectedTab === 'mine'"
        (click)="selectTab('mine')"
      >
        MY INCIDENTS
      </button>
    </div>
  </div>

  <div class="filters-section">
    <h2>Filter by Status</h2>
    <div class="status-filters">
      <label *ngFor="let s of statusOptions">
        <input
          type="checkbox"
          [checked]="selectedStatuses.includes(s.value)"
          (change)="onFilterChange(s.value, ($any($event.target).checked))"
        />
        <span class="status-pill" [style.background-color]="s.color">
          {{ s.label }}
        </span>
      </label>
    </div>
  </div>

  <div *ngIf="isLoading" class="loading">Loading incidents...</div>
  <div *ngIf="error && !isLoading" class="error">{{ error }}</div>

  <div *ngIf="!isLoading && !error" class="incidents-list">
    <div
      *ngFor="let i of filteredIncidents"
      class="incident-card"
      [style.border-left]="'6px solid ' + getStatusColor(i.status)"
    >
      <div class="card-header">
        <span class="status" [style.color]="getStatusColor(i.status)">
          {{ i.status | uppercase }}
        </span>
        <span class="date">{{ formatDate(i.createdAt) }}</span>
      </div>

      <h3>{{ i.title }}</h3>
      <p>{{ i.description }}</p>

      <div class="card-footer">
        <div class="info">
          <span>ID: #{{ i.id }}</span>
          <span>Created By: {{ i.createdBy }}</span>
        </div>
        <div class="actions">
          <button class="view" (click)="openViewDetails(i)">
            View Details
          </button>
          <button class="update" *ngIf="i.status !== 'closed'">
            Update
          </button>
          <a
            *ngIf="i.fileUrl"
            [href]="i.fileUrl"
            target="_blank"
            class="file"
          >
            View File
          </a>
        </div>
      </div>
    </div>
  </div>

  <footer class="app-footer">
    <p>Â© 2025 SafeWork. All rights reserved.</p>
  </footer>

  <!-- Modals -->
  <app-new-incident
    *ngIf="showNewIncident"
    (close)="closeNewIncident()"
  ></app-new-incident>

  <app-view-details
    *ngIf="showViewDetails && selectedIncident"
    [incident]="selectedIncident"
    (close)="closeViewDetails()"
  ></app-view-details>
</div>
